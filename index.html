<!DOCTYPE html>
<html>
<head>
    <title>Enactus Mini Game-1 (Absolute Scoring)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --bg: #f8f9fa;
            --danger: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            padding: 10px;
            margin: 0;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: auto;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        h1 { font-size: 1.5rem; margin-bottom: 10px; }

        .round-box {
            background: var(--primary);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            display: inline-block;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        @media (min-width: 600px) {
            .input-grid { grid-template-columns: repeat(4, 1fr); }
            .container { padding: 30px; }
        }

        .team-input {
            border: 1px solid #ddd;
            padding: 12px 5px;
            border-radius: 8px;
            text-align: center;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .team-input label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .team-input input {
            width: 80%;
            max-width: 60px;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            text-transform: uppercase;
            border: 2px solid var(--accent);
            border-radius: 6px;
            outline: none;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        button {
            flex: 1;
            max-width: 200px;
            padding: 15px;
            cursor: pointer;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            transition: opacity 0.2s;
        }

        .btn-go { background: var(--success); color: white; }
        .btn-reset { background: var(--danger); color: white; }
        button:active { opacity: 0.7; }
        button:disabled { background: #ccc; cursor: not-allowed; }

        .victory {
            display: none;
            background: #d4edda;
            border: 2px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .table-wrapper {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 450px;
        }

        th, td {
            border: 1px solid #eee;
            padding: 12px 8px;
            text-align: center;
            font-size: 0.9rem;
        }

        th { background: #f8f9fa; color: var(--primary); }
        .leader { background: #fff3cd; font-weight: bold; }

        .history-section { margin-top: 40px; }
        h2 { font-size: 1.2rem; border-left: 4px solid var(--accent); padding-left: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Enactus Mini Game-1</h1>
            <div class="round-box">Round: <span id="roundDisp">1</span>/6</div>
        </div>

        <div id="winMsg" class="victory">
            <h2 style="margin:0">Game Over!</h2>
            <p id="winnerLine" style="font-weight:bold; font-size:1.2rem;"></p>
            <p>Tiebreaker: Most Least-Chosen options, then Team Name.</p>
        </div>

        <div class="input-grid" id="grid"></div>

        <div class="controls">
            <button id="subBtn" class="btn-go" onclick="runRound()">Process Round</button>
            <button class="btn-reset" onclick="reset()">Reset</button>
        </div>

        <h2>Scoreboard</h2>
        <div class="table-wrapper">
            <table id="scoresTable">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Team</th>
                        <th>Score</th>
                        <th>Least Chosen Count</th>
                    </tr>
                </thead>
                <tbody id="scoreBody"></tbody>
            </table>
        </div>

        <div class="history-section">
            <h2>Team Decision History</h2>
            <div class="table-wrapper">
                <table id="histTable">
                    <thead><tr id="histHead"><th>Team</th></tr></thead>
                    <tbody id="histBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let round = 1;
        const MAX_ROUNDS = 6;
        let done = false;
        let teams = Array.from({length: 8}, (_, i) => ({ 
            id: i+1, 
            name: "Team "+(i+1), 
            score: 0, 
            leastCount: 0, 
            log: [] 
        }));

        function setup() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            teams.forEach(t => {
                grid.innerHTML += `<div class="team-input"><label>${t.name}</label><input id="t${t.id}" maxlength="1" placeholder="R/G/B" inputmode="text"></div>`;
            });
            updateUI();
        }

        function runRound() {
            if (done) return;
            let selections = {};
            let counts = { R: 0, G: 0, B: 0 }; 

            // 1. Collect inputs
            for (let i = 1; i <= 8; i++) {
                let val = document.getElementById('t'+i).value.toUpperCase().trim();
                if (!['R','G','B'].includes(val)) {
                    alert("Error: Team "+i+" must enter R, G, or B");
                    return;
                }
                selections[i] = val;
                counts[val]++;
            }

            // 2. Determine which option(s) was chosen the least for the tiebreaker
            let activeEntries = Object.entries(counts).filter(([opt, count]) => count > 0);
            let minVal = Math.min(...activeEntries.map(([opt, count]) => count));
            let leastChosenList = activeEntries
                .filter(([opt, count]) => count === minVal)
                .map(([opt, count]) => opt);

            // 3. Process Scoring (Directly based on counts)
            teams.forEach(t => {
                let choice = selections[t.id];
                let n = counts[choice];
                let pts = 0;

                // 5 pts for 1 person, 3 pts for 2 people, 1 pt for 3 people
                if (n === 1) pts = 5;
                else if (n === 2) pts = 3;
                else if (n === 3) pts = 1;
                else pts = 0;

                t.score += pts;
                
                // Tiebreaker check: did they pick the rarest option this round?
                if (leastChosenList.includes(choice)) {
                    t.leastCount++;
                }

                t.log.push({ choice, pts });
            });

            updateUI();
            
            if (round >= MAX_ROUNDS) {
                endGame();
            } else {
                round++;
                document.getElementById('roundDisp').innerText = round;
                // Clear inputs for next round
                teams.forEach(t => document.getElementById('t'+t.id).value = '');
            }
        }

        function updateUI() {
            // Ranking logic: Score -> LeastChosenCount -> Lower Team ID (Name)
            let sorted = [...teams].sort((a,b) => {
                if (b.score !== a.score) return b.score - a.score;
                if (b.leastCount !== a.leastCount) return b.leastCount - a.leastCount;
                return a.id - b.id; 
            });

            const sBody = document.getElementById('scoreBody');
            sBody.innerHTML = sorted.map((t, i) => `
                <tr class="${i === 0 && t.score > 0 ? 'leader' : ''}">
                    <td>${i+1}</td>
                    <td>${t.name}</td>
                    <td>${t.score}</td>
                    <td>${t.leastCount}</td>
                </tr>`).join('');

            const hHead = document.getElementById('histHead');
            while (hHead.cells.length <= round) {
                let th = document.createElement('th');
                th.innerText = "R" + (hHead.cells.length);
                hHead.appendChild(th);
            }

            const hBody = document.getElementById('histBody');
            hBody.innerHTML = teams.map(t => `<tr>
                <td><strong>${t.name}</strong></td>
                ${t.log.map(l => `<td>${l.choice} (${l.pts})</td>`).join('')}
            </tr>`).join('');
        }

        function endGame() {
            done = true;
            document.getElementById('winMsg').style.display = 'block';
            document.getElementById('subBtn').disabled = true;
            
            let sorted = [...teams].sort((a,b) => {
                if (b.score !== a.score) return b.score - a.score;
                if (b.leastCount !== a.leastCount) return b.leastCount - a.leastCount;
                return a.id - b.id;
            });
            
            document.getElementById('winnerLine').innerText = "Winner: " + sorted[0].name;
        }

        function reset() {
            if (confirm("Reset game? All scores will be lost.")) location.reload();
        }

        setup();
    </script>
</body>
</html>
